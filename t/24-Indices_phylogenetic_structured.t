#!/usr/bin/perl -w
use strict;
use warnings;
use Carp;

use rlib;
use Test::More;
use Data::Section::Simple qw{
    get_data_section
};

local $| = 1;

use Biodiverse::BaseData;
use Biodiverse::Indices;
use Biodiverse::TestHelpers qw{
    :basedata
    :runners
    :tree
};

my $phylo_calcs_to_test = [qw/
    calc_phylo_aed
    calc_pd_node_list
/];
run_indices_phylogenetic (
    phylo_calcs_to_test  => $phylo_calcs_to_test,
    get_expected_results => \&get_expected_results
);
done_testing;

sub get_expected_results {
    my %args = @_;
    my $nbr_list_count = $args{nbr_list_count};
    if ($nbr_list_count == 1) { return {
        'PD_INCLUDED_NODE_LIST' => {
            '49___' => '0.020427284632173',
            '34___' => '0.341398923434153',
            '50___' => '0.00121523842637206',
            'Genus:sp20' => '0.5',
            'Genus:sp26' => '0.5',
            '42___' => '0.057495084175743',
            '35___' => '0.03299436960061',
            '45___' => '0.026396763298318',
            '59___' => 0,
            '52___' => '0.00291112550535999',
            '58___' => '0.00993044169650192'
        },
        'PHYLO_ED_LIST' => {
            'Genus:sp26' => '0.682552763166875',
            'Genus:sp20' => '0.682552763166875'
        },
        'PHYLO_AED_LIST' => {
            'Genus:sp26' => '0.207128205128205',
            'Genus:sp20' => '0.144628205128205'
        },
        'PHYLO_ES_LIST' => {
            'Genus:sp26' => '0.688503612046397',
            'Genus:sp20' => '0.688503612046397'
        },
    }; }
    elsif ($nbr_list_count == 2) { return {
        'PD_INCLUDED_NODE_LIST' => {
            'Genus:sp23' => '0.434782608695652',
            '50___' => '0.00121523842637206',
            'Genus:sp26' => '0.5',
            '42___' => '0.057495084175743',
            '30___' => '0.077662337662338',
            '45___' => '0.026396763298318',
            '38___' => '0.0272381982058111',
            '37___' => '0.11249075347436',
            '31___' => '0.098714969241285',
            'Genus:sp27' => '0.666666666666667',
            'Genus:sp15' => '0.578947368421053',
            '34___' => '0.341398923434153',
            'Genus:sp29' => '0.598591139574746',
            'Genus:sp24' => '0.25',
            '44___' => '0.265221710543839',
            '36___' => '0.051317777404734',
            'Genus:sp10' => '0.784362816006563',
            '58___' => '0.00993044169650192',
            '49___' => '0.020427284632173',
            '39___' => '0.172696292660468',
            'Genus:sp20' => '0.5',
            '32___' => '0.106700478344225',
            '59___' => 0,
            'Genus:sp12' => '0.625829337780557',
            'Genus:sp5' => '0.6',
            '33___' => '0.05703610742759',
            '51___' => '0.729927663567369',
            '35___' => '0.03299436960061',
            'Genus:sp30' => '0.434782608695652',
            'Genus:sp25' => '0.25',
            'Genus:sp11' => '0.486100386100386',
            '41___' => '0.075867662593738',
            'Genus:sp1' => '0.578947368421053',
            '52___' => '0.00291112550535999'
        },
        'PHYLO_ED_LIST'  => {
            'Genus:sp27' => '0.758106931866058',
            'Genus:sp12' => '0.678346653904325',
            'Genus:sp15' => '0.678240495563069',
            'Genus:sp23' => '0.557265280898026',
            'Genus:sp5'  => '0.688766811352542',
            'Genus:sp26' => '0.682552763166875',
            'Genus:sp20' => '0.682552763166875',
            'Genus:sp29' => '0.657918005249967',
            'Genus:sp24' => '0.615416143402958',
            'Genus:sp30' => '0.557265280898026',
            'Genus:sp25' => '0.615416143402958',
            'Genus:sp11' => '0.582924169600393',
            'Genus:sp10' => '0.80762333894188',
            'Genus:sp1'  => '0.678240495563069'
        },
        'PHYLO_AED_LIST'  => {
             'Genus:sp27' => '0.599310252633764',
             'Genus:sp12' => '0.050539886453687',
             'Genus:sp15' => '0.040524675881928',
             'Genus:sp23' => '0.148203607227373',
             'Genus:sp5'  => '0.386675699373672',
             'Genus:sp26' => '0.0627272750008093',
             'Genus:sp20' => '0.041893941667476',
             'Genus:sp29' => '0.0728869137531598',
             'Genus:sp24' => '0.305963938866254',
             'Genus:sp30' => '0.256899259401286',
             'Genus:sp25' => '0.368463938866254',
             'Genus:sp11' => '0.0494076062574589',
             'Genus:sp10' => '0.0281896757943279',
             'Genus:sp1'  => '0.0503930969345596'
        },
        'PHYLO_ES_LIST' => {
            'Genus:sp27' => '0.808752211567386',
            'Genus:sp12' => '0.740699957688393',
            'Genus:sp15' => '0.66656052363853',
            'Genus:sp23' => '0.506327788030815',
            'Genus:sp5'  => '0.677086839428004',
            'Genus:sp26' => '0.688503612046397',
            'Genus:sp20' => '0.688503612046397',
            'Genus:sp29' => '0.66964554863157',
            'Genus:sp24' => '0.616932918372087',
            'Genus:sp30' => '0.506327788030815',
            'Genus:sp25' => '0.616932918372087',
            'Genus:sp11' => '0.577872967365978',
            'Genus:sp10' => '0.830685020049678',
            'Genus:sp1'  => '0.66656052363853'
        },
    }; }
    else {
        croak 'Invalid nbr_list_count';
    }
}

1;

