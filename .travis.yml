#os:
#  - linux
#  - osx
#language: perl
matrix:
    include:
        - os: linux
          perl: '5.24'
          env: BD_NO_TEST_GUI=1
          dist: trusty
          language: perl
        - os: linux
          perl: '5.24'
          env: BD_NO_TEST_GUI=0
          dist: trusty
          language: perl
        - os: linux
          perl: '5.22'
          env: BD_NO_TEST_GUI=1
          dist: trusty
          language: perl

#sudo: required
cache:
  directories:
    - perl_modules
    - gdal_builds

before_install:

  #  local::lib target is cached
  - cpanm --notest local::lib
  - eval "$(perl -Mlocal::lib=${PWD}/perl_modules)"

  #  just to be sure 
  - find . -name "build_gdal_travis.sh" -print
  #- echo ${PWD}
  
  #  call the gdal build script
  #- chmod +x ./etc/build_gdal_travis.sh
  - sh ./etc/build_gdal_travis.sh

  #  Disable Gtk stuff for speed reasons
  #  Reinstate when we add the GUI variant
  - if [ "$BD_NO_TEST_GUI" = 0 ]; then sudo apt-get install libgnomecanvas2-dev; fi;

  # Here as well as cpanfile because of dependency problems if not installed before Gnome2::Canvas
  - if [ "$BD_NO_TEST_GUI" = 0 ]; then cpanm --notest ExtUtils::Depends ExtUtils::PkgConfig Glib Gtk2; fi;

  - if [ "$BD_NO_TEST_GUI" = 0 ]; then cpanm --quiet --installdeps --notest --with-all-features .; fi;


script: prove -l -j4
# blocklist
branches:
  except:
  - ppm
