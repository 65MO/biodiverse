<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Biodiverse: Biodiverse::Spatial Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Biodiverse
   &#160;<span id="projectnumber">0.19</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classBiodiverse_1_1Spatial.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classBiodiverse_1_1Spatial-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Biodiverse::Spatial Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for Biodiverse::Spatial:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classBiodiverse_1_1Spatial__coll__graph.png" border="0" usemap="#Biodiverse_1_1Spatial_coll__map" alt="Collaboration graph"/></div>
<map name="Biodiverse_1_1Spatial_coll__map" id="Biodiverse_1_1Spatial_coll__map">
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:aeb1ede83b953779a47f24afc283123a1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aeb1ede83b953779a47f24afc283123a1"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>EMPTY_STRING</b></td></tr>
<tr class="separator:aeb1ede83b953779a47f24afc283123a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6044b233bbf57517d9acc7678e2fc2d0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6044b233bbf57517d9acc7678e2fc2d0"></a>
hash&#160;</td><td class="memItemRight" valign="bottom"><b>elements_to_use</b></td></tr>
<tr class="separator:a6044b233bbf57517d9acc7678e2fc2d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a7112d614e41826808e34392f576d61"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9a7112d614e41826808e34392f576d61"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>elts</b></td></tr>
<tr class="separator:a9a7112d614e41826808e34392f576d61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a758cda8d88484bf7dc603c91eca7ae19"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a758cda8d88484bf7dc603c91eca7ae19"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>gps</b></td></tr>
<tr class="separator:a758cda8d88484bf7dc603c91eca7ae19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a246ebd89418c96ebb811a9b753f5afd9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a246ebd89418c96ebb811a9b753f5afd9"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>elements_to_calc</b></td></tr>
<tr class="separator:a246ebd89418c96ebb811a9b753f5afd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5fdc2049e5e9da1ab3b8bb04a063d58"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad5fdc2049e5e9da1ab3b8bb04a063d58"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>elements_to_exclude</b></td></tr>
<tr class="separator:ad5fdc2049e5e9da1ab3b8bb04a063d58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a280f194b9b333fe569d299a8a5fc2826"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a280f194b9b333fe569d299a8a5fc2826"></a>
hash&#160;</td><td class="memItemRight" valign="bottom"><b>elements_to_exclude_h</b></td></tr>
<tr class="separator:a280f194b9b333fe569d299a8a5fc2826"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a441fa3ab0f614cde94775b519a4be207"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a441fa3ab0f614cde94775b519a4be207"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>exclude_processed_elements</b></td></tr>
<tr class="separator:a441fa3ab0f614cde94775b519a4be207"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07fe7f68ab2857635b06c1ffc5a0548a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a07fe7f68ab2857635b06c1ffc5a0548a"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>name</b></td></tr>
<tr class="separator:a07fe7f68ab2857635b06c1ffc5a0548a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf27659cd2c19e06b2e51f6c9af0e40f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adf27659cd2c19e06b2e51f6c9af0e40f"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>progress_text_base</b></td></tr>
<tr class="separator:adf27659cd2c19e06b2e51f6c9af0e40f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af48c95ecfb6413b3dfaa44279f8cd5b2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af48c95ecfb6413b3dfaa44279f8cd5b2"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>toDo</b></td></tr>
<tr class="separator:af48c95ecfb6413b3dfaa44279f8cd5b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ffff7b99bf95622f36cf8e3bf644197"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1ffff7b99bf95622f36cf8e3bf644197"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>pass_def_query</b></td></tr>
<tr class="separator:a1ffff7b99bf95622f36cf8e3bf644197"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adad7ffd125869955d2db50d3d1208510"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adad7ffd125869955d2db50d3d1208510"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>progress_text_create</b></td></tr>
<tr class="separator:adad7ffd125869955d2db50d3d1208510"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab295d7ed91adc99638b501a16d86c822"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab295d7ed91adc99638b501a16d86c822"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>progress</b></td></tr>
<tr class="separator:ab295d7ed91adc99638b501a16d86c822"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a8d381187449da6528ea958486a6dd9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3a8d381187449da6528ea958486a6dd9"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>failed_def_query_sp_res_hash</b></td></tr>
<tr class="separator:a3a8d381187449da6528ea958486a6dd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad99d5881cd5d928d94a6094441c79809"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad99d5881cd5d928d94a6094441c79809"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>elt_count</b></td></tr>
<tr class="separator:ad99d5881cd5d928d94a6094441c79809"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e66f7e934549218fb0d87b75d73ec19"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8e66f7e934549218fb0d87b75d73ec19"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>csv_object</b></td></tr>
<tr class="separator:a8e66f7e934549218fb0d87b75d73ec19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5dcec9c15314180d61ec7aea02562161"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5dcec9c15314180d61ec7aea02562161"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>progress_so_far</b></td></tr>
<tr class="separator:a5dcec9c15314180d61ec7aea02562161"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a936c9435b2c33d66bf5c2bad8e69d253"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a936c9435b2c33d66bf5c2bad8e69d253"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>progress_text</b></td></tr>
<tr class="separator:a936c9435b2c33d66bf5c2bad8e69d253"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f9f343206572b6ad93a547cabf85795"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2f9f343206572b6ad93a547cabf85795"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>sp_res_hash</b></td></tr>
<tr class="separator:a2f9f343206572b6ad93a547cabf85795"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab17ded23cdcde53ed36d57001b6af530"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab17ded23cdcde53ed36d57001b6af530"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>using_index_text</b></td></tr>
<tr class="separator:ab17ded23cdcde53ed36d57001b6af530"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf80bfa9c2b47db183a0246d6bcabb84"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaf80bfa9c2b47db183a0246d6bcabb84"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>recyc_count</b></td></tr>
<tr class="separator:aaf80bfa9c2b47db183a0246d6bcabb84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add54f8c4456007c6f8fe9195907242b9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="add54f8c4456007c6f8fe9195907242b9"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>pass</b></td></tr>
<tr class="separator:add54f8c4456007c6f8fe9195907242b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed20dd1735386feaa6c781e651addcc4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aed20dd1735386feaa6c781e651addcc4"></a>
list&#160;</td><td class="memItemRight" valign="bottom"><b>nbr_list</b></td></tr>
<tr class="separator:aed20dd1735386feaa6c781e651addcc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9007397860b739a319723997074399d5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9007397860b739a319723997074399d5"></a>
hash&#160;</td><td class="memItemRight" valign="bottom"><b>elements</b></td></tr>
<tr class="separator:a9007397860b739a319723997074399d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aacb7fdef216e0ecfb3886b66710d8265"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aacb7fdef216e0ecfb3886b66710d8265"></a>
hash&#160;</td><td class="memItemRight" valign="bottom"><b>sp_calc_values</b></td></tr>
<tr class="separator:aacb7fdef216e0ecfb3886b66710d8265"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf7031f2f0141dac1d8f9d05d0afa273"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaf7031f2f0141dac1d8f9d05d0afa273"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>recycle_lists</b></td></tr>
<tr class="separator:aaf7031f2f0141dac1d8f9d05d0afa273"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b28a75271c9b5a4668eba708a4b5070"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7b28a75271c9b5a4668eba708a4b5070"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>list_ref</b></td></tr>
<tr class="separator:a7b28a75271c9b5a4668eba708a4b5070"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99afd81262db35e231cc7fc93434d8c2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a99afd81262db35e231cc7fc93434d8c2"></a>
hash&#160;</td><td class="memItemRight" valign="bottom"><b>nbrs_1</b></td></tr>
<tr class="separator:a99afd81262db35e231cc7fc93434d8c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a891b3e7aebec0ed0f1452189b6e9446f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a891b3e7aebec0ed0f1452189b6e9446f"></a>
hash&#160;</td><td class="memItemRight" valign="bottom"><b>post_calc_globals</b></td></tr>
<tr class="separator:a891b3e7aebec0ed0f1452189b6e9446f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc67d4668c84c1b53ff413b7df01e041"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afc67d4668c84c1b53ff413b7df01e041"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>lists</b></td></tr>
<tr class="separator:afc67d4668c84c1b53ff413b7df01e041"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8e4a8795f8ee8ff71b3c4d64959bfbf"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab8e4a8795f8ee8ff71b3c4d64959bfbf"></a>
scalar&#160;</td><td class="memItemRight" valign="bottom"><b>time_taken</b></td></tr>
<tr class="separator:ab8e4a8795f8ee8ff71b3c4d64959bfbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="member-group"></a>
Avaliable Methods</h2></td></tr>
<tr class="memitem:af695f8192d7d2c50965497f65c59298b"><td class="memItemLeft" align="right" valign="top">private method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#af695f8192d7d2c50965497f65c59298b">_check_results_recycled_properly</a> ()</td></tr>
<tr class="separator:af695f8192d7d2c50965497f65c59298b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eb114b9a67bf06b10bd8ff96ae7d255"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#a7eb114b9a67bf06b10bd8ff96ae7d255">get_recyclable_nbrhoods</a> ()</td></tr>
<tr class="separator:a7eb114b9a67bf06b10bd8ff96ae7d255"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cff4c54195059113134fc6006ad8e5f"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#a3cff4c54195059113134fc6006ad8e5f">get_embedded_tree</a> ()</td></tr>
<tr class="separator:a3cff4c54195059113134fc6006ad8e5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03ebf7f985e0d79c3140df09dbbbcfd8"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#a03ebf7f985e0d79c3140df09dbbbcfd8">find_list_indices_across_elements</a> ()</td></tr>
<tr class="separator:a03ebf7f985e0d79c3140df09dbbbcfd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0136ec13bfedd3ef2b1777e3ab07b91c"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#a0136ec13bfedd3ef2b1777e3ab07b91c">compare</a> ()</td></tr>
<tr class="separator:a0136ec13bfedd3ef2b1777e3ab07b91c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f6b974b6f86bc4a95ea1b92144fd87c"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#a8f6b974b6f86bc4a95ea1b92144fd87c">nbr_list_already_recycled</a> ()</td></tr>
<tr class="separator:a8f6b974b6f86bc4a95ea1b92144fd87c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae08f68a9799d4c14fcdf41eba6c1e8e5"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#ae08f68a9799d4c14fcdf41eba6c1e8e5">recycle_nbr_lists</a> ()</td></tr>
<tr class="separator:ae08f68a9799d4c14fcdf41eba6c1e8e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca9c615918a9ee5377b42e0a7a11a42e"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#aca9c615918a9ee5377b42e0a7a11a42e">get_nbrs_for_element</a> ()</td></tr>
<tr class="separator:aca9c615918a9ee5377b42e0a7a11a42e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d53e2a795d14c6f8b8f8211fb101944"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#a0d53e2a795d14c6f8b8f8211fb101944">get_spatial_params_ref</a> ()</td></tr>
<tr class="separator:a0d53e2a795d14c6f8b8f8211fb101944"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf91574f3ed8c839605ed4bb6af823fb"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#adf91574f3ed8c839605ed4bb6af823fb">run_analysis</a> ()</td></tr>
<tr class="separator:adf91574f3ed8c839605ed4bb6af823fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb67f8c3c88a34b4d7f9a917579397b2"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#abb67f8c3c88a34b4d7f9a917579397b2">get_embedded_matrix</a> ()</td></tr>
<tr class="separator:abb67f8c3c88a34b4d7f9a917579397b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf472b0b413502a243a46ede3a91e274"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#aaf472b0b413502a243a46ede3a91e274">recycle_list_results</a> ()</td></tr>
<tr class="separator:aaf472b0b413502a243a46ede3a91e274"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51bb3cdd1276aa01d6deb1fd91c38ca0"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#a51bb3cdd1276aa01d6deb1fd91c38ca0">get_groups_that_pass_def_query</a> ()</td></tr>
<tr class="separator:a51bb3cdd1276aa01d6deb1fd91c38ca0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8e7d7b542d320d4e3f3cd4d9116ca58"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#aa8e7d7b542d320d4e3f3cd4d9116ca58">sp_calc</a> ()</td></tr>
<tr class="separator:aa8e7d7b542d320d4e3f3cd4d9116ca58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63b897504406457d380f13bbe9975f28"><td class="memItemLeft" align="right" valign="top">public method&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBiodiverse_1_1Spatial.html#a63b897504406457d380f13bbe9975f28">get_definition_query</a> ()</td></tr>
<tr class="separator:a63b897504406457d380f13bbe9975f28"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="anchor" id="NAME"></a>
NAME</h1>
<p><a class="el" href="classBiodiverse_1_1Spatial.html">Biodiverse::Spatial</a> - a set of spatial functions for a <a class="el" href="classBiodiverse_1_1BaseStruct.html">Biodiverse::BaseStruct</a> object. POD IS MASSIVELY OUT OF DATE</p>
<h1><a class="anchor" id="SYNOPSIS"></a>
SYNOPSIS</h1>
<pre>  use <a class="el" href="classBiodiverse_1_1Spatial.html">Biodiverse::Spatial</a>;</pre><h1><a class="anchor" id="DESCRIPTION"></a>
DESCRIPTION</h1>
<p>These functions should be inherited by higher level objects through their @ISA list.</p>
<p>MANY OF THESE HAVE BEEN MOVED BACK TO <a class="el" href="classBiodiverse_1_1BaseData.html">Biodiverse::BaseData</a>.</p>
<h2><a class="anchor" id="Assumptions"></a>
Assumptions</h2>
<p>Assumes </p>
<div class="fragment"><div class="line"><a class="code" href="classBiodiverse_1_1Common.html">Biodiverse::Common</a></div>
</div><!-- fragment --><p> is in the @ISA list.</p>
<p>Almost all methods in the Biodiverse library use {keyword =&gt; value} pairs as a policy. This means some of the methods may appear to contain unnecessary arguments, but it makes everything else more consistent.</p>
<p>List methods return a list in list context, and a reference to that list in scalar context.</p>
<h1><a class="anchor" id="Methods"></a>
Methods</h1>
<p>These assume you have declared an object called $self of a type that inherits these methods, normally:</p>
<ul>
<li>
<a class="anchor" id="item__self___Biodiverse__BaseData__gt_new_"></a><b>$self = <a class="el" href="classBiodiverse_1_1BaseData.html">Biodiverse::BaseData</a>-&gt;new;</b>  </li>
</ul>
<h2><a class="anchor" id="Function_Calls"></a>
Function Calls</h2>
<ul>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_add_spatial_output_"></a><b>$self-&gt;add_spatial_output;</b> </p>
<p>Adds a spatial output object to the list of spatial outputs. This is of type </p>
<div class="fragment"><div class="line"><a class="code" href="classBiodiverse_1_1BaseStruct.html">Biodiverse::BaseStruct</a></div>
</div><!-- fragment --><p> .</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_get_spatial_outputs_"></a><b>$self-&gt;get_spatial_outputs;</b> </p>
<p>Returns the hash containing the <a class="el" href="classBiodiverse_1_1Spatial.html">Spatial</a> Output names and their references.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_delete_spatial_output__name___gt___somename___"></a><b>$self-&gt;delete_spatial_output (name =&gt; 'somename');</b> </p>
<p>Deletes the spatial output referred to as name </p>
<div class="fragment"><div class="line">somename</div>
</div><!-- fragment --><p> .</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_get_spatial_output_ref__name___gt___name__"></a><b>$self-&gt;get_spatial_output_ref (name =&gt; $name);</b> </p>
<p>Gets the reference to the named spatial output object.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_get_spatial_output_list_"></a><b>$self-&gt;get_spatial_output_list;</b> </p>
<p>Gets an array of the spatial output objects in this <a class="el" href="classBiodiverse_1_1BaseData.html">BaseData</a> object.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_get_spatial_output_refs_"></a><b>$self-&gt;get_spatial_output_refs;</b> </p>
<p>Gets an array of references to the spatial output objects in this <a class="el" href="classBiodiverse_1_1BaseData.html">Biodiverse::BaseData</a> object. These are of type </p>
<div class="fragment"><div class="line"><a class="code" href="classBiodiverse_1_1BaseStruct.html">Biodiverse::BaseStruct</a></div>
</div><!-- fragment --><p> .</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_get_spatial_output_names__name___gt___somename___"></a><b>$self-&gt;get_spatial_output_names (name =&gt; 'somename');</b> </p>
<p>Returns the reference to the named spatial output. Returns </p>
<div class="fragment"><div class="line">undef</div>
</div><!-- fragment --><p> if it does not exist or if argument</p>
<div class="fragment"><div class="line">name</div>
</div><!-- fragment --><p> is not specified.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_predict_offsets__spatial_paramshashref___gt___hash_ref__"></a><b>$self-&gt;predict_offsets (spatial_paramshashref =&gt; $hash_ref);</b> </p>
<p>Predict the maximum spatial distances needed to search based on an indexed Groups object within the Basedata object.</p>
<p></p>
<p>The input hash can be generated using </p>
<div class="fragment"><div class="line">Biodiverse::Common::parse_spatial_params</div>
</div><!-- fragment --><p> , and the index using </p>
<div class="fragment"><div class="line">Biodiverse::BaseData::build_index</div>
</div><!-- fragment --><p> .</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_get_neighbours__element___gt___element__parsed_spatial_params___gt______spatialParams__exclude_list___gt______list__"></a><b>$self-&gt;get_neighbours (element =&gt; $element, parsed_spatial_params =&gt; \%spatialParams, exclude_list =&gt; \@list);</b> </p>
<p>Gets a hash of the neighbours around $element that satisfy the conditions in %spatialParams. Calls </p>
<div class="fragment"><div class="line">parse_spatial_params</div>
</div><!-- fragment --><p> if not specified. The exclusion list is the set of elements not to be added. This makes it easy to avoid double counting of neighbours and simplifies spatial parameters settings.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_get_neighbours_as_array__element___gt___element__parsed_spatial_params___gt______spatialParams__exclude_list_______list__"></a><b>$self-&gt;get_neighbours_as_array (element =&gt; $element, parsed_spatial_params =&gt; \%spatialParams, exclude_list = \@list);</b> </p>
<p>Returns an array instead of a hash. Just calls get_neighbours and sorts the keys.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__self__gt_get_distances__coord_array1___gt___element1__coord_array2___gt___element2__"></a><b>$self-&gt;get_distances (coord_array1 =&gt; $element1, coord_array2 =&gt; $element2);</b> </p>
<p>ALL THIS IS OUT OF DATE.</p>
<p></p>
<p>Calculate the distances between the coords in two sets of elements using parameters derived from </p>
<div class="fragment"><div class="line">Biodiverse::Common::parse_spatial_params</div>
</div><!-- fragment --><p> .</p>
<p></p>
<p>As of version 1 we only use Euclidean distance denoted by $D, $D[0], $D[1], $d[0], $d[1] etc. The actual values are determined using </p>
<div class="fragment"><div class="line">Biodiverse::Spatial::get_distances</div>
</div><!-- fragment --><p> .</p>
<p></p>
<p>$D is the absolute euclidean distance across all dimensions.</p>
<p></p>
<p>$D[0], $D[1] and so forth are the absolute distance in dimension 0, 1 etc. In most cases this $D[0] will be the X dimension, $D[1] will be the y dimension.</p>
<p></p>
<p>$d[0], $d[1] and so forth are the signed distance in dimension 0, 1 etc. This allows us to extract all groups within some distance in some direction. As with standard cartesion plots, negative values are to the left or below (west or south), positive values to the right or above (east or north). As with $D[0], $d[0] will normally be the X dimension, $d[1] will be the y dimension.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="anchor" id="item__sp__gt_sp_calc_calculations___gt______calculations__"></a><b>$sp-&gt;sp_calc(calculations =&gt; \%calculations);</b> </p>
<p>Calculate one or more spatial indices specified in %calculations using neighbourhood parameters stored in the objects's parameters.</p>
<p></p>
<p>The results are stored in spatial object $sp.</p>
<p></p>
<p>%calculations must have the same structure as that returned by</p>
<div class="fragment"><div class="line"><a class="code" href="classBiodiverse_1_1Indices.html#a6a89b78257465421ebfa2351710adb89">Biodiverse::Indices::get_calculations</a></div>
</div><!-- fragment --><p> .</p>
<p></p>
<p>Runs all available calculations if none are specified.</p>
<p></p>
<p>Any other arguments are passed straight through to the indices.</p>
<p></p>
<p>The </p>
<div class="fragment"><div class="line">cache_*</div>
</div><!-- fragment --><p> options allow the user to cache the element, label and ABC lists for direct export, although we will be adding methods to do this to save on storage space when it is exported (perl stores hash keys in a global list, so there is little overhead when using hash keys multiple times).</p>
<p></p>
<p>The ABC lists are stored by default, as it is useful to display them and all the indices depend on them.</p>
<p></p>
<p>Scalar results are added to the <a class="el" href="classBiodiverse_1_1Spatial.html">Spatial</a> Output object's SPATIAL_OUTPUT hash. Any lists are added as separate lists in the object, rather than pollute the SPATIAL_OUTPUT hash with additional lists.</p>
<p class="endli"></p>
</li>
</ul>
<h1><a class="anchor" id="REPORTING_ERRORS"></a>
REPORTING ERRORS</h1>
<p>I read my email frequently, so use that. It should be pretty stable, though.</p>
<h1><a class="anchor" id="AUTHOR"></a>
AUTHOR</h1>
<p>Shawn Laffan</p>
<p>Shawn.Laffan@unsw.edu.au</p>
<h1><a class="anchor" id="COPYRIGHT"></a>
COPYRIGHT</h1>
<p>Copyright (c) 2006 Shawn Laffan. All rights reserved. This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
<h1><a class="anchor" id="REVISION_HISTORY"></a>
REVISION HISTORY</h1>
<ul>
<li>
<p class="startli"><a class="anchor" id="item_Version____"></a><b>Version ???</b> </p>
<p>May 2006. Source libraries developed to the point where they can be distributed.</p>
<p class="endli"></p>
</li>
</ul>

<p>Definition at line <a class="el" href="Spatial_8pm_source.html#l00204">204</a> of file <a class="el" href="Spatial_8pm_source.html">Spatial.pm</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="af695f8192d7d2c50965497f65c59298b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">private method Biodiverse::Spatial::_check_results_recycled_properly </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-_check_results_recycled_properly' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-_check_results_recycled_properly-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_check_results_recycled_properly-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_check_results_recycled_properly-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in _check_results_recycled_properly: 28</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#af695f8192d7d2c50965497f65c59298b">_check_results_recycled_properly</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line">    </div>
<div class="line">    my $element = $args{element};</div>
<div class="line">    my $use_nbrs_from = $args{use_nbrs_from};</div>
<div class="line">    </div>
<div class="line">    my $results_are_recyclable = $args{results_are_recyclable};</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ($use_nbrs_from &amp;&amp; $results_are_recyclable) {</div>
<div class="line">        my $list1_ref = $self-&gt;get_list_ref (</div>
<div class="line">            element =&gt; $element,</div>
<div class="line">            list    =&gt; <span class="stringliteral">&#39;SPATIAL_RESULTS&#39;</span>,</div>
<div class="line">        );</div>
<div class="line">        </div>
<div class="line">        my $list2_ref = $use_nbrs_from-&gt;get_list_ref (</div>
<div class="line">            element =&gt; $element,</div>
<div class="line">            list    =&gt; <span class="stringliteral">&#39;SPATIAL_RESULTS&#39;</span>,</div>
<div class="line">        );</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">while</span> (my ($key, $value1) = each %$list1_ref) {</div>
<div class="line">            my $value2 = $list2_ref-&gt;{$key};</div>
<div class="line">            croak <span class="stringliteral">&quot;$value1 != $value2, $element\n&quot;</span> <span class="keywordflow">if</span> $value1 != $value2;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="a0136ec13bfedd3ef2b1777e3ab07b91c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::compare </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-compare' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-compare-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-compare-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-compare-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in compare: 140</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#a0136ec13bfedd3ef2b1777e3ab07b91c">compare</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  make all numeric warnings fatal to catch locale/sprintf issues</span></div>
<div class="line"><span class="preprocessor"></span>    use warnings FATAL =&gt; qw { numeric };</div>
<div class="line">    </div>
<div class="line">    my $comparison = $args{comparison};</div>
<div class="line">    croak <span class="stringliteral">&quot;Comparison not specified\n&quot;</span> <span class="keywordflow">if</span> not defined $comparison;</div>
<div class="line">    </div>
<div class="line">    my $result_list_pfx = $args{result_list_name};</div>
<div class="line">    croak qq{Argument <span class="stringliteral">&#39;result_list_pfx&#39;</span> not specified\n}</div>
<div class="line">        <span class="keywordflow">if</span> ! defined $result_list_pfx;</div>
<div class="line"></div>
<div class="line">    my $progress = <a class="code" href="classBiodiverse_1_1Progress.html">Biodiverse::Progress</a>-&gt;<a class="code" href="classBiodiverse_1_1Progress.html#a88f4cef6f66986952a850fb70a2b62d8">new</a>();</div>
<div class="line">    my $progress_text = <span class="stringliteral">&#39;Comparing &#39;</span></div>
<div class="line">                        . $self-&gt;get_param (<span class="stringliteral">&#39;NAME&#39;</span>)</div>
<div class="line">                        . <span class="stringliteral">&#39; with &#39;</span></div>
<div class="line">                        . $comparison-&gt;get_param (<span class="stringliteral">&#39;NAME&#39;</span>)</div>
<div class="line">                        . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">    $progress-&gt;update ($progress_text, 0);</div>
<div class="line"></div>
<div class="line">    my $bd = $self-&gt;get_param (<span class="stringliteral">&#39;BASEDATA_REF&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  drop out if no elements to compare with</span></div>
<div class="line"><span class="preprocessor"></span>    my $e_list = $self-&gt;get_element_list;</div>
<div class="line">    <span class="keywordflow">return</span> 1 <span class="keywordflow">if</span> not scalar @$e_list;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    my %base_list_indices = $self-&gt;find_list_indices_across_elements;</div>
<div class="line">    $base_list_indices{SPATIAL_RESULTS} = <span class="stringliteral">&#39;SPATIAL_RESULTS&#39;</span>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  now we need to calculate the appropriate result list name</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    # for example RAND25&gt;&gt;SPATIAL_RESULTS</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">foreach</span> my $list_name (keys %base_list_indices) {</div>
<div class="line">        $base_list_indices{$list_name} = $result_list_pfx . <span class="stringliteral">&#39;&gt;&gt;&#39;</span> . $list_name;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    my $to_do = $self-&gt;get_element_count;</div>
<div class="line">    my $i = 0;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  easy way of handling recycled lists</span></div>
<div class="line"><span class="preprocessor"></span>    my %done_base; </div>
<div class="line">    my %done_comp;</div>
<div class="line">    </div>
<div class="line">    my $recycled_results</div>
<div class="line">      =    $self-&gt;get_param (<span class="stringliteral">&#39;RESULTS_ARE_RECYCLABLE&#39;</span>)</div>
<div class="line">        &amp;&amp; $comparison-&gt;get_param (<span class="stringliteral">&#39;RESULTS_ARE_RECYCLABLE&#39;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> ($recycled_results &amp;&amp; exists $args{no_recycle}) {  #  mostly <span class="keywordflow">for</span> debug </div>
<div class="line">        $recycled_results = $args{no_recycle};</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ($recycled_results) {  #  <span class="keyword">set</span> up some lists</div>
<div class="line">        <span class="keywordflow">foreach</span> my $list_name (keys %base_list_indices) {</div>
<div class="line">            $done_base{$list_name} = {};</div>
<div class="line">            $done_comp{$list_name} = {};</div>
<div class="line">        }</div>
<div class="line">    }    </div>
<div class="line"></div>
<div class="line">    COMP_BY_ELEMENT:</div>
<div class="line">    <span class="keywordflow">foreach</span> my $element ($self-&gt;get_element_list) {</div>
<div class="line">        $i++;</div>
<div class="line"></div>
<div class="line">        $progress-&gt;update (</div>
<div class="line">            $progress_text . <span class="stringliteral">&quot;(element $i / $to_do)&quot;</span>,</div>
<div class="line">            $i / $to_do,</div>
<div class="line">        );</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        #  now loop over the list indices</span></div>
<div class="line"><span class="preprocessor"></span>        BY_LIST:</div>
<div class="line">        <span class="keywordflow">while</span> (my ($list_name, $result_list_name) = each %base_list_indices) {</div>
<div class="line"></div>
<div class="line">            next BY_LIST</div>
<div class="line">                <span class="keywordflow">if</span>    $recycled_results</div>
<div class="line">                   &amp;&amp; $done_base{$list_name}{$element}</div>
<div class="line">                   &amp;&amp; $done_comp{$list_name}{$element};</div>
<div class="line"></div>
<div class="line">            my $base_ref = $self-&gt;get_list_ref (</div>
<div class="line">                element     =&gt; $element,</div>
<div class="line">                list        =&gt; $list_name,</div>
<div class="line">                autovivify  =&gt; 0,</div>
<div class="line">            );</div>
<div class="line">            my $comp_ref = $comparison-&gt;get_list_ref (</div>
<div class="line">                element     =&gt; $element,</div>
<div class="line">                list        =&gt; $list_name,</div>
<div class="line">                autovivify  =&gt; 0,</div>
<div class="line">            );</div>
<div class="line"></div>
<div class="line">            next BY_LIST <span class="keywordflow">if</span> ! $base_ref || ! $comp_ref; #  nothing to <a class="code" href="classBiodiverse_1_1Spatial.html#a0136ec13bfedd3ef2b1777e3ab07b91c">compare</a> with...</div>
<div class="line"></div>
<div class="line">            next BY_LIST <span class="keywordflow">if</span> (ref $base_ref) =~ /ARRAY/;</div>
<div class="line"></div>
<div class="line">            my $results_ref = $self-&gt;get_list_ref (</div>
<div class="line">                element =&gt; $element,</div>
<div class="line">                list    =&gt; $result_list_name,</div>
<div class="line">            );</div>
<div class="line">    </div>
<div class="line">            $self-&gt;compare_lists_by_item (</div>
<div class="line">                base_list_ref     =&gt; $base_ref,</div>
<div class="line">                comp_list_ref     =&gt; $comp_ref,</div>
<div class="line">                results_list_ref  =&gt; $results_ref,</div>
<div class="line">            );</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">            #  if results from both base and comp</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            #  are recycled then we can recycle the comparisons</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="keywordflow">if</span> ($recycled_results) {</div>
<div class="line">                my $nbrs = $self-&gt;get_list_ref (</div>
<div class="line">                    element =&gt; $element,</div>
<div class="line">                    list    =&gt; <span class="stringliteral">&#39;RESULTS_SAME_AS&#39;</span>,</div>
<div class="line">                );</div>
<div class="line"></div>
<div class="line">                my $results_ref = $self-&gt;get_list_ref (</div>
<div class="line">                    element =&gt; $element,</div>
<div class="line">                    list    =&gt; $result_list_name,</div>
<div class="line">                );</div>
<div class="line"></div>
<div class="line">                BY_RECYCLED_NBR:</div>
<div class="line">                <span class="keywordflow">foreach</span> my $nbr (keys %$nbrs) {</div>
<div class="line">                    $self-&gt;add_to_lists (</div>
<div class="line">                        element           =&gt; $nbr,</div>
<div class="line">                        $result_list_name =&gt; $results_ref,</div>
<div class="line">                        use_ref           =&gt; 1,</div>
<div class="line">                    );</div>
<div class="line">                }</div>
<div class="line">                my $done_base_hash = $done_base{$list_name};</div>
<div class="line">                my $done_comp_hash = $done_comp{$list_name};</div>
<div class="line">                @{$done_base_hash}{keys %$nbrs}</div>
<div class="line">                    = values %$nbrs;</div>
<div class="line">                @{$done_comp_hash}{keys %$nbrs}</div>
<div class="line">                    = values %$nbrs;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    $self-&gt;set_last_update_time;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="a03ebf7f985e0d79c3140df09dbbbcfd8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::find_list_indices_across_elements </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-find_list_indices_across_elements' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-find_list_indices_across_elements-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-find_list_indices_across_elements-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-find_list_indices_across_elements-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in find_list_indices_across_elements: 23</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#a03ebf7f985e0d79c3140df09dbbbcfd8">find_list_indices_across_elements</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line">    </div>
<div class="line">    my @lists = $self-&gt;get_lists_across_elements;</div>
<div class="line">    </div>
<div class="line">    my $bd = $self-&gt;get_param (<span class="stringliteral">&#39;BASEDATA_REF&#39;</span>);</div>
<div class="line">    my $indices_object = <a class="code" href="classBiodiverse_1_1Indices.html">Biodiverse::Indices</a>-&gt;<a class="code" href="classBiodiverse_1_1Indices.html#a9b653e2cf5ae1ebc02b930dabae47779">new</a>(BASEDATA_REF =&gt; $bd);</div>
<div class="line"></div>
<div class="line">    my %calculations_by_index = $indices_object-&gt;get_index_source_hash;</div>
<div class="line"></div>
<div class="line">    my %index_hash;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  loop over the lists and find those that are generated by a calculation</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #  This ensures we get all of them if subsets are used.</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">foreach</span> my $list_name (@lists) {</div>
<div class="line">        <span class="keywordflow">if</span> (exists $calculations_by_index{$list_name}) {</div>
<div class="line">            $index_hash{$list_name} = $list_name;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> wantarray ? %index_hash : \%index_hash;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="a63b897504406457d380f13bbe9975f28"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::get_definition_query </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_definition_query' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-get_definition_query-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_definition_query-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_definition_query-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in get_definition_query: 24</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#a63b897504406457d380f13bbe9975f28">get_definition_query</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line">    </div>
<div class="line">    my $definition_query = $self-&gt;get_param (<span class="stringliteral">&#39;DEFINITION_QUERY&#39;</span>)</div>
<div class="line">                           || $args{definition_query};</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keywordflow">if</span> ! defined $definition_query;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (length ($definition_query) == 0) {</div>
<div class="line">        $definition_query = undef ;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #  now parse the query into an object if needed</span></div>
<div class="line"><span class="preprocessor"></span>    elsif (not blessed $definition_query) {</div>
<div class="line">        $definition_query = Biodiverse::SpatialParams::DefQuery-&gt;new (</div>
<div class="line">            conditions =&gt; $definition_query,</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    $self-&gt;set_param (DEFINITION_QUERY =&gt; $definition_query);</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> $definition_query;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="abb67f8c3c88a34b4d7f9a917579397b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::get_embedded_matrix </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_embedded_matrix' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-get_embedded_matrix-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_embedded_matrix-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_embedded_matrix-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in get_embedded_matrix: 9</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#abb67f8c3c88a34b4d7f9a917579397b2">get_embedded_matrix</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    </div>
<div class="line">    my $args = $self-&gt;get_param (<span class="stringliteral">&#39;SP_CALC_ARGS&#39;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $args-&gt;{matrix_ref} <span class="keywordflow">if</span> exists $args-&gt;{matrix_ref};</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="a3cff4c54195059113134fc6006ad8e5f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::get_embedded_tree </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_embedded_tree' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-get_embedded_tree-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_embedded_tree-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_embedded_tree-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in get_embedded_tree: 9</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#a3cff4c54195059113134fc6006ad8e5f">get_embedded_tree</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    </div>
<div class="line">    my $args = $self-&gt;get_param (<span class="stringliteral">&#39;SP_CALC_ARGS&#39;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $args-&gt;{tree_ref} <span class="keywordflow">if</span> exists $args-&gt;{tree_ref};</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="a51bb3cdd1276aa01d6deb1fd91c38ca0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::get_groups_that_pass_def_query </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_groups_that_pass_def_query' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-get_groups_that_pass_def_query-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_groups_that_pass_def_query-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_groups_that_pass_def_query-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in get_groups_that_pass_def_query: 36</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#a51bb3cdd1276aa01d6deb1fd91c38ca0">get_groups_that_pass_def_query</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line"></div>
<div class="line">    my $definition_query = $self-&gt;get_definition_query (%args);</div>
<div class="line">    my $passed = $self-&gt;get_param(<span class="stringliteral">&#39;PASS_DEF_QUERY&#39;</span>) || {};</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> wantarray ? %$passed : $passed</div>
<div class="line">      <span class="keywordflow">if</span> $self-&gt;exists_param(<span class="stringliteral">&#39;PASS_DEF_QUERY&#39;</span>) || !$definition_query;</div>
<div class="line"></div>
<div class="line">    my $bd = $self-&gt;get_basedata_ref;</div>
<div class="line"></div>
<div class="line">    print <span class="stringliteral">&quot;Running definition query\n&quot;</span>;</div>
<div class="line">    my $elements_to_calc = $args{elements_to_calc};</div>
<div class="line">    my $element = $elements_to_calc-&gt;[0];</div>
<div class="line">    my $defq_progress = <a class="code" href="classBiodiverse_1_1Progress.html">Biodiverse::Progress</a>-&gt;<a class="code" href="classBiodiverse_1_1Progress.html#a88f4cef6f66986952a850fb70a2b62d8">new</a>(text =&gt; <span class="stringliteral">&#39;def query&#39;</span>);</div>
<div class="line"></div>
<div class="line">    $passed</div>
<div class="line">      = $bd-&gt;get_neighbours(</div>
<div class="line">            element        =&gt; $element,</div>
<div class="line">            spatial_params =&gt; $definition_query,</div>
<div class="line">            is_def_query   =&gt; 1,</div>
<div class="line">            progress       =&gt; $defq_progress,</div>
<div class="line">        );</div>
<div class="line">    $self-&gt;set_param (PASS_DEF_QUERY =&gt; $passed);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (! scalar keys %$passed) {</div>
<div class="line">        $self-&gt;clear_spatial_condition_caches;</div>
<div class="line">        croak <span class="stringliteral">&quot;Nothing passed the definition query\n&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    my $pass_count = scalar keys %$passed;</div>
<div class="line">    print <span class="stringliteral">&quot;$pass_count groups passed the definition query\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> wantarray ? %$passed : $passed;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="aca9c615918a9ee5377b42e0a7a11a42e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::get_nbrs_for_element </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_nbrs_for_element' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-get_nbrs_for_element-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_nbrs_for_element-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_nbrs_for_element-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in get_nbrs_for_element: 132</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#aca9c615918a9ee5377b42e0a7a11a42e">get_nbrs_for_element</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line"></div>
<div class="line">    my $element       = $args{element};</div>
<div class="line">    my $use_nbrs_from = $args{use_nbrs_from};</div>
<div class="line">    my $elements_to_exclude = $args{elements_to_exclude};</div>
<div class="line">    my $search_blocks_ref = $args{search_blocks_ref};</div>
<div class="line">    </div>
<div class="line">    my $spatial_params_ref = $self-&gt;get_param(<span class="stringliteral">&#39;SPATIAL_PARAMS&#39;</span>);</div>
<div class="line">    my $sp_index = $self-&gt;get_param (<span class="stringliteral">&#39;SPATIAL_INDEX&#39;</span>);</div>
<div class="line">    my $bd = $self-&gt;get_basedata_ref;</div>
<div class="line"></div>
<div class="line">    my @nbr_list;</div>
<div class="line">    my @exclude;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">foreach</span> my $i (0 .. $#$spatial_params_ref) {</div>
<div class="line">        my $nbr_list_name = <span class="stringliteral">&#39;_NBR_SET&#39;</span> . ($i+1);</div>
<div class="line"><span class="preprocessor">        #  useful since we can have non-overlapping neighbourhoods</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #  where we set all the results in one go</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span> ($self-&gt;exists_list (</div>
<div class="line">                element =&gt; $element,</div>
<div class="line">                list    =&gt; $nbr_list_name</div>
<div class="line">            )) {</div>
<div class="line"></div>
<div class="line">            my $nbrs</div>
<div class="line">              = $self-&gt;get_list_values (</div>
<div class="line">                  element =&gt; $element,</div>
<div class="line">                  list    =&gt; $nbr_list_name,</div>
<div class="line">              )</div>
<div class="line">              || [];</div>
<div class="line"></div>
<div class="line">            $nbr_list[$i] = $nbrs;</div>
<div class="line">            push @exclude, @$nbrs;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> ($use_nbrs_from) {</div>
<div class="line">                $nbr_list[$i] = $use_nbrs_from-&gt;get_list_values (</div>
<div class="line">                    element =&gt; $element,</div>
<div class="line">                    list    =&gt; $nbr_list_name,</div>
<div class="line">                );</div>
<div class="line">                <span class="keywordflow">if</span> (! defined $nbr_list[$i]) {</div>
<div class="line">                    $nbr_list[$i] = [];  #  use empty list <span class="keywordflow">if</span> necessary</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">            #  if $use_nbrs_from lacks the list, or we&#39;re finding the neighbours ourselves</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="keywordflow">if</span> (not defined $nbr_list[$i]) {  </div>
<div class="line">                my $list;</div>
<div class="line">                my $result_type = $spatial_params_ref-&gt;[$i]-&gt;get_result_type;</div>
<div class="line"><span class="preprocessor">                #  get everything</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordflow">if</span> ($result_type eq <span class="stringliteral">&#39;always_true&#39;</span>) {  </div>
<div class="line">                    $list = $bd-&gt;get_groups;</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">                #  nothing to work with</span></div>
<div class="line"><span class="preprocessor"></span>                elsif ($result_type eq <span class="stringliteral">&#39;always_false&#39;</span>) {  </div>
<div class="line">                    $list = [];</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">                #  no nbrs, just oneself</span></div>
<div class="line"><span class="preprocessor"></span>                elsif ($result_type eq <span class="stringliteral">&#39;self_only&#39;</span>) {</div>
<div class="line">                    $list = [$element];</div>
<div class="line">                }</div>
<div class="line"><span class="preprocessor">                #  if nbrs are always the same</span></div>
<div class="line"><span class="preprocessor"></span>                elsif ($result_type eq <span class="stringliteral">&#39;always_same&#39;</span>) {</div>
<div class="line">                    my $tmp = $self-&gt;get_cached_value(<span class="stringliteral">&#39;NBRS_FROM_ALWAYS_SAME&#39;</span>);</div>
<div class="line">                    <span class="keywordflow">if</span> ($tmp &amp;&amp; $tmp-&gt;[$i]) {</div>
<div class="line">                        my $nbrs = $tmp-&gt;[$i];</div>
<div class="line">                        $list = [keys %$nbrs];</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> ($list) {</div>
<div class="line">                    my %tmp;  #  <span class="keyword">remove</span> any that should not be there</div>
<div class="line">                    my $excl = [@exclude, @$elements_to_exclude];</div>
<div class="line">                    @tmp{@$list} = (1) x @$list;</div>
<div class="line">                    <span class="keyword">delete</span> @tmp{@$excl};</div>
<div class="line">                    $nbr_list[$i] = [keys %tmp];</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {    #  no nbr list thus far so go looking</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">                    #  don&#39;t use the index if there are no search blocks</span></div>
<div class="line"><span class="preprocessor"></span>                    my $sp_index_i = defined $search_blocks_ref-&gt;[$i]</div>
<div class="line">                      ? $sp_index</div>
<div class="line">                      : undef;</div>
<div class="line"></div>
<div class="line">                    my %args_for_nbr_list = (</div>
<div class="line">                        element         =&gt; $element,</div>
<div class="line">                        spatial_params  =&gt; $spatial_params_ref-&gt;[$i],</div>
<div class="line">                        index           =&gt; $sp_index_i,</div>
<div class="line">                        index_offsets   =&gt; $search_blocks_ref-&gt;[$i],</div>
<div class="line">                    );</div>
<div class="line">                    my $exclude_list = [@exclude, @$elements_to_exclude];</div>
<div class="line"></div>
<div class="line">                    <span class="keywordflow">if</span> ($result_type eq <span class="stringliteral">&#39;always_same&#39;</span>) {</div>
<div class="line">                        my $progr = <a class="code" href="classBiodiverse_1_1Progress.html">Biodiverse::Progress</a>-&gt;<a class="code" href="classBiodiverse_1_1Progress.html#a88f4cef6f66986952a850fb70a2b62d8">new</a>(text =&gt; <span class="stringliteral">&#39;Neighbour comparisons for first always_same condition&#39;</span>);</div>
<div class="line">                        my $tmp = $bd-&gt;get_neighbours (</div>
<div class="line">                            %args_for_nbr_list,</div>
<div class="line">                            progress =&gt; $progr,</div>
<div class="line">                        );</div>
<div class="line">                        $progr = undef;</div>
<div class="line">                        my $cached_arr = $self-&gt;get_cached_value(<span class="stringliteral">&#39;NBRS_FROM_ALWAYS_SAME&#39;</span>);</div>
<div class="line">                        <span class="keywordflow">if</span> (!$cached_arr) {</div>
<div class="line">                            $cached_arr = [];</div>
<div class="line">                            $self-&gt;set_cached_value(NBRS_FROM_ALWAYS_SAME =&gt; $cached_arr);</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                        $cached_arr-&gt;[$i] = $tmp;</div>
<div class="line">                        my %tmp2 = %$tmp;</div>
<div class="line">                        <span class="keyword">delete</span> @tmp2{@$exclude_list};</div>
<div class="line">                        $nbr_list[$i] = [keys %tmp2];</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="preprocessor">                        #  go search</span></div>
<div class="line"><span class="preprocessor"></span>                        $nbr_list[$i] = $bd-&gt;get_neighbours_as_array (</div>
<div class="line">                            %args_for_nbr_list,</div>
<div class="line">                            exclude_list =&gt; $exclude_list,</div>
<div class="line">                        );</div>
<div class="line">                    }</div>
<div class="line"></div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">                #  Add to the exclude list unless we are at the last spatial param,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">                #  in which case it is no longer needed.</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">                #  Hopefully this will save meaningful memory for large neighbour sets</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordflow">if</span> ($i != $#$spatial_params_ref) {</div>
<div class="line">                    push @exclude, @{$nbr_list[$i]};</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            $self-&gt;add_to_lists (</div>
<div class="line">                element        =&gt; $element,</div>
<div class="line">                $nbr_list_name =&gt; $nbr_list[$i],</div>
<div class="line">            );</div>
<div class="line">        }</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="a7eb114b9a67bf06b10bd8ff96ae7d255"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::get_recyclable_nbrhoods </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_recyclable_nbrhoods' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-get_recyclable_nbrhoods-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_recyclable_nbrhoods-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_recyclable_nbrhoods-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in get_recyclable_nbrhoods: 41</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#a7eb114b9a67bf06b10bd8ff96ae7d255">get_recyclable_nbrhoods</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line"></div>
<div class="line">    my $spatial_params_ref = $self-&gt;get_spatial_params_ref;</div>
<div class="line"></div>
<div class="line">    my @recyclable_nbrhoods;</div>
<div class="line">    my $results_are_recyclable = 0;</div>
<div class="line"></div>
<div class="line">    my %recyc_candidates = (</div>
<div class="line">        non_overlapping  =&gt; 0,     # only index 0</div>
<div class="line">        always_true      =&gt; undef, # any index</div>
<div class="line">        text_match_exact =&gt; undef, # any index</div>
<div class="line"><span class="preprocessor">        #always_same      =&gt; undef, # any index</span></div>
<div class="line"><span class="preprocessor"></span>    );</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> my $i (0 .. $#$spatial_params_ref) {</div>
<div class="line">        my $result_type = $spatial_params_ref-&gt;[$i]-&gt;get_result_type;</div>
<div class="line"></div>
<div class="line">        my $prev_nbr_is_recyclable = 1;  #  always check first one</div>
<div class="line">        <span class="keywordflow">if</span> ($i &gt; 0) {  #  only check $i <span class="keywordflow">if</span> $i-1 is <span class="keyword">true</span></div>
<div class="line">            $prev_nbr_is_recyclable = $recyclable_nbrhoods[$i-1];</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (    $prev_nbr_is_recyclable</div>
<div class="line">             &amp;&amp; exists $recyc_candidates{$result_type} ) {</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">            # only those in the first nbrhood,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            # or if the previous nbrhood is recyclable</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            # and we allow recyc beyond first index</span></div>
<div class="line"><span class="preprocessor"></span>            my $is_valid_recyc_index =</div>
<div class="line">              defined $recyc_candidates{$result_type}</div>
<div class="line">                ? $i &lt;= $recyc_candidates{$result_type}</div>
<div class="line">                : 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ( $is_valid_recyc_index ) { </div>
<div class="line">                $recyclable_nbrhoods[$i] = 1;</div>
<div class="line">                $results_are_recyclable ++;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="a0d53e2a795d14c6f8b8f8211fb101944"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::get_spatial_params_ref </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-get_spatial_params_ref' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-get_spatial_params_ref-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-get_spatial_params_ref-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-get_spatial_params_ref-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in get_spatial_params_ref: 48</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#a0d53e2a795d14c6f8b8f8211fb101944">get_spatial_params_ref</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args  = @_;</div>
<div class="line">    </div>
<div class="line">    my $spatial_params_ref = $self-&gt;get_param (<span class="stringliteral">&#39;SPATIAL_PARAMS&#39;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> $spatial_params_ref <span class="keywordflow">if</span> defined $spatial_params_ref;</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    #  if we don&#39;t already have spatial params then check the arguments</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    croak <span class="stringliteral">&quot;spatial_conditions not an array ref or not defined\n&quot;</span></div>
<div class="line">      <span class="keywordflow">if</span> not (ref $args{spatial_conditions}) =~ /ARRAY/;</div>
<div class="line"></div>
<div class="line">    $spatial_params_ref = $args{spatial_conditions};</div>
<div class="line">    my $check = 1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> ($check) {  #  clean up undef params at the end</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (scalar @$spatial_params_ref == 0) {</div>
<div class="line">            warn <span class="stringliteral">&quot;[Spatial] No valid spatial conditions specified\n&quot;</span>;</div>
<div class="line"><span class="preprocessor">            #  put an empty string as the only entry,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">            #  saves problems down the line</span></div>
<div class="line"><span class="preprocessor"></span>            $spatial_params_ref-&gt;[0] = $EMPTY_STRING;</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line"><span class="preprocessor">        #my $param = $spatial_params_ref-&gt;[$#$spatial_params_ref];</span></div>
<div class="line"><span class="preprocessor"></span>        my $param = $spatial_params_ref-&gt;[-1];</div>
<div class="line">        $param =~ s/^\s*<span class="comment">//;  #  strip leading and trailing whitespace</span></div>
<div class="line">        $param =~ s/\s*$<span class="comment">//;</span></div>
<div class="line">        <span class="keywordflow">if</span> (! defined $param || $param eq $EMPTY_STRING) {</div>
<div class="line">            print <span class="stringliteral">&quot;[SPATIAL] Deleting undefined spatial condition\n&quot;</span>;</div>
<div class="line">            pop @$spatial_params_ref;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">            $check = 0;  #  stop checking</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #  Now loop over them and parse the spatial params into objects if needed</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">for</span> my $i (0 .. $#$spatial_params_ref) {</div>
<div class="line">        <span class="keywordflow">if</span> (! blessed $spatial_params_ref-&gt;[$i]) {</div>
<div class="line">            $spatial_params_ref-&gt;[$i]</div>
<div class="line">                = <a class="code" href="classBiodiverse_1_1SpatialParams.html">Biodiverse::SpatialParams</a>-&gt;<a class="code" href="classBiodiverse_1_1SpatialParams.html#ac00e15542ca8b5c91b7c581d5f80f7f4">new</a> (</div>
<div class="line">                    conditions   =&gt; $spatial_params_ref-&gt;[$i],</div>
<div class="line">                    basedata_ref =&gt; $self-&gt;get_basedata_ref,</div>
<div class="line">                );</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="a8f6b974b6f86bc4a95ea1b92144fd87c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::nbr_list_already_recycled </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-nbr_list_already_recycled' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-nbr_list_already_recycled-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-nbr_list_already_recycled-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-nbr_list_already_recycled-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in nbr_list_already_recycled: 12</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#a8f6b974b6f86bc4a95ea1b92144fd87c">nbr_list_already_recycled</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  we only work on the first nbr set</span></div>
<div class="line"><span class="preprocessor"></span>    my $nbr_list_name = <span class="stringliteral">&#39;_NBR_SET0&#39;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;exists_list (</div>
<div class="line">        element =&gt; $args{element},</div>
<div class="line">        list    =&gt; $nbr_list_name</div>
<div class="line">    );    </div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="aaf472b0b413502a243a46ede3a91e274"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::recycle_list_results </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-recycle_list_results' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-recycle_list_results-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-recycle_list_results-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-recycle_list_results-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in recycle_list_results: 28</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#aaf472b0b413502a243a46ede3a91e274">recycle_list_results</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line">    </div>
<div class="line">    my $nbrs_1           = $args{nbrs_1};</div>
<div class="line">    my $definition_query = $args{definition_query};</div>
<div class="line">    my $pass_def_query   = $args{pass_def_query};</div>
<div class="line">    my $list_hash        = $args{list_hash};</div>
<div class="line"></div>
<div class="line">    RECYC_INTO_NBRS1:</div>
<div class="line">    <span class="keywordflow">foreach</span> my $nbr (keys %$nbrs_1) {</div>
<div class="line">        <span class="keywordflow">if</span> ($definition_query) {</div>
<div class="line">            my $pass = exists $pass_def_query-&gt;{$nbr};</div>
<div class="line">            next RECYC_INTO_NBRS1 <span class="keywordflow">if</span> not $pass;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">while</span> (my ($listname, $list_ref) = each %$list_hash) {</div>
<div class="line">            $self-&gt;add_to_lists (</div>
<div class="line">                element   =&gt; $nbr,</div>
<div class="line">                $listname =&gt; $list_ref,</div>
<div class="line">                use_ref   =&gt; 1,</div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="ae08f68a9799d4c14fcdf41eba6c1e8e5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::recycle_nbr_lists </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-recycle_nbr_lists' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-recycle_nbr_lists-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-recycle_nbr_lists-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-recycle_nbr_lists-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in recycle_nbr_lists: 43</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#ae08f68a9799d4c14fcdf41eba6c1e8e5">recycle_nbr_lists</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line">    </div>
<div class="line">    my $recyclable_nbrhoods = $args{recyclable_nbrhoods};</div>
<div class="line">    my $nbr_lists           = $args{nbr_lists};</div>
<div class="line">    my $nbrs_1              = $args{nbrs_1};</div>
<div class="line">    my $definition_query    = $args{definition_query};</div>
<div class="line">    my $pass_def_query      = $args{pass_def_query};</div>
<div class="line">    my $element             = $args{element};</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    #  for each nbr in %nbrs_1,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #  copy the neighbour sets for those that overlap</span></div>
<div class="line"><span class="preprocessor"></span>    LOOP_RECYC_NBRHOODS:</div>
<div class="line">    <span class="keywordflow">foreach</span> my $i (0 .. $#$recyclable_nbrhoods) {</div>
<div class="line"><span class="preprocessor">        #  all preceding must be recyclable</span></div>
<div class="line"><span class="preprocessor"></span>        last LOOP_RECYC_NBRHOODS</div>
<div class="line">            <span class="keywordflow">if</span> ! $recyclable_nbrhoods-&gt;[$i];  </div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        #  this is set above</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">        #next LOOP_RECYC_NBRHOODS if $nbrs_recycled;</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        my $nbr_list_name = <span class="stringliteral">&#39;_NBR_SET&#39;</span> . ($i+1);</div>
<div class="line">        my $nbr_list_ref = $nbr_lists-&gt;[$i];</div>
<div class="line"></div>
<div class="line">        LOOP_RECYC_NBRS:</div>
<div class="line">        <span class="keywordflow">foreach</span> my $nbr (keys %$nbrs_1) {</div>
<div class="line"><span class="preprocessor">            #  don&#39;t append to processing element - we set it above</span></div>
<div class="line"><span class="preprocessor"></span>            next LOOP_RECYC_NBRS <span class="keywordflow">if</span> $nbr eq $element;  </div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ($definition_query) {</div>
<div class="line">                my $pass = exists $pass_def_query-&gt;{$nbr};</div>
<div class="line">                next LOOP_RECYC_NBRS <span class="keywordflow">if</span> not $pass;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">            #  recycle the array using a ref to save space</span></div>
<div class="line"><span class="preprocessor"></span>            $self-&gt;add_to_lists (</div>
<div class="line">                element         =&gt; $nbr,</div>
<div class="line">                $nbr_list_name  =&gt; $nbr_lists-&gt;[$i],</div>
<div class="line">                use_ref         =&gt; 1,  </div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="adf91574f3ed8c839605ed4bb6af823fb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::run_analysis </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-run_analysis' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-run_analysis-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-run_analysis-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-run_analysis-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in run_analysis: 4</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#adf91574f3ed8c839605ed4bb6af823fb">run_analysis</a> {</div>
<div class="line">    my $self = shift;</div>
<div class="line">    <span class="keywordflow">return</span> $self-&gt;sp_calc(@_);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<a class="anchor" id="aa8e7d7b542d320d4e3f3cd4d9116ca58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public method Biodiverse::Spatial::sp_calc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Undocumented Method  
<div id='codesection-sp_calc' class='dynheader closed' style='cursor:pointer;' onclick='return toggleVisibility(this)'>
    <img id='codesection-sp_calc-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-sp_calc-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-sp_calc-content' class='dyncontent' style='display: none;'>
 <div class="fragment"><div class="line"><span class="preprocessor"># Number of lines of code in sp_calc: 143</span></div>
<div class="line"><span class="preprocessor"></span>sub <a class="code" href="classBiodiverse_1_1Spatial.html#aa8e7d7b542d320d4e3f3cd4d9116ca58">sp_calc</a> {  </div>
<div class="line">    my $self = shift;</div>
<div class="line">    my %args = @_;</div>
<div class="line"></div>
<div class="line">    print <span class="stringliteral">&quot;[SPATIAL] Running analysis &quot;</span></div>
<div class="line">          . $self-&gt;get_param(<span class="stringliteral">&#39;NAME&#39;</span>)</div>
<div class="line">          . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  don&#39;t store this arg if specified</span></div>
<div class="line"><span class="preprocessor"></span>    my $use_nbrs_from = $args{use_nbrs_from};</div>
<div class="line">    <span class="keyword">delete</span> $args{use_nbrs_from};  </div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    #  flag for use if we drop out.  Set to 1 on completion.</span></div>
<div class="line"><span class="preprocessor"></span>    $self-&gt;set_param (COMPLETED =&gt; 0);</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    #  load any predefined args - overriding user specified ones</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #  need to change this to be ANALYSIS_ARGS</span></div>
<div class="line"><span class="preprocessor"></span>    my $ref = $self-&gt;get_param (<span class="stringliteral">&#39;SP_CALC_ARGS&#39;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (defined $ref) {</div>
<div class="line">        %args = %$ref;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">    # a little backwards compatibility since we&#39;ve changed the nomenclature</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span> (! exists $args{calculations} &amp;&amp; exists $args{analyses}) {</div>
<div class="line">        $args{calculations} = $args{analyses};</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    my $no_create_failed_def_query = $args{no_create_failed_def_query};</div>
<div class="line">    my $calc_only_elements_to_calc = $args{calc_only_elements_to_calc};</div>
<div class="line"></div>
<div class="line">    my $spatial_params_ref  = $self-&gt;get_spatial_params_ref (%args);</div>
<div class="line">    my $recyclable_nbrhoods = $self-&gt;get_recyclable_nbrhoods;</div>
<div class="line">    my $results_are_recyclable = $self-&gt;get_param(<span class="stringliteral">&#39;RESULTS_ARE_RECYCLABLE&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  check the definition query</span></div>
<div class="line"><span class="preprocessor"></span>    my $definition_query</div>
<div class="line">      = $self-&gt;get_definition_query (definition_query =&gt; $args{definition_query});</div>
<div class="line"></div>
<div class="line">    my $start_time = time;</div>
<div class="line"></div>
<div class="line">    my $bd = $self-&gt;get_param (<span class="stringliteral">&#39;BASEDATA_REF&#39;</span>);</div>
<div class="line">    my $gps_ref = $bd-&gt;get_groups_ref;</div>
<div class="line"></div>
<div class="line">    my $indices_object = <a class="code" href="classBiodiverse_1_1Indices.html">Biodiverse::Indices</a>-&gt;<a class="code" href="classBiodiverse_1_1Indices.html#a9b653e2cf5ae1ebc02b930dabae47779">new</a>(</div>
<div class="line">        BASEDATA_REF =&gt; $bd,</div>
<div class="line">        NAME         =&gt; <span class="stringliteral">&#39;Indices for &#39;</span> . $self-&gt;get_param(<span class="stringliteral">&#39;NAME&#39;</span>),</div>
<div class="line">    );</div>
<div class="line"></div>
<div class="line">    my $nbr_list_count = scalar @$spatial_params_ref;</div>
<div class="line">    $indices_object-&gt;get_valid_calculations (</div>
<div class="line">        %args,</div>
<div class="line">        nbr_list_count =&gt; $nbr_list_count,</div>
<div class="line">        element_list1 =&gt; [],  #  <span class="keywordflow">for</span> validity checking only</div>
<div class="line">        element_list2 =&gt; $nbr_list_count == 2 ? [] : undef,</div>
<div class="line">        processing_element =&gt; <span class="charliteral">&#39;x&#39;</span>,</div>
<div class="line">    );</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  drop out if we have none to do and we don&#39;t have an override flag</span></div>
<div class="line"><span class="preprocessor"></span>    croak <span class="stringliteral">&quot;[SPATIAL] No valid analyses, dropping out\n&quot;</span></div>
<div class="line">        <span class="keywordflow">if</span> (        $indices_object-&gt;get_valid_calculation_count == 0</div>
<div class="line">            and not $args{override_valid_analysis_check});</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  this is for the GUI</span></div>
<div class="line"><span class="preprocessor"></span>    $self-&gt;set_param (CALCULATIONS_REQUESTED =&gt; $args{calculations});</div>
<div class="line"><span class="preprocessor">    #  save the args, but override the calcs so we only store the valid ones</span></div>
<div class="line"><span class="preprocessor"></span>    my $valid_calcs = scalar $indices_object-&gt;get_valid_calculations_to_run;</div>
<div class="line">    $self-&gt;set_param (</div>
<div class="line">        SP_CALC_ARGS =&gt; {</div>
<div class="line">            %args,</div>
<div class="line">            calculations =&gt; [keys %$valid_calcs],</div>
<div class="line">        }</div>
<div class="line">    );</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  don&#39;t pass these onwards when we call the calcs</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keyword">delete</span> @args{qw /calculations analyses/};  </div>
<div class="line"></div>
<div class="line">    print <span class="stringliteral">&quot;[SPATIAL] running calculations &quot;</span></div>
<div class="line">          . (join (q{ }, sort keys %{$indices_object-&gt;get_valid_calculations_to_run}))</div>
<div class="line">          . <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  use whatever spatial index the parent is currently using if nothing already set</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #  if the basedata object has no index, then we won&#39;t either</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span> (not $self-&gt;exists_param (<span class="stringliteral">&#39;SPATIAL_INDEX&#39;</span>)) {</div>
<div class="line">        $self-&gt;set_param (</div>
<div class="line">            SPATIAL_INDEX =&gt; $bd-&gt;get_param (<span class="stringliteral">&#39;SPATIAL_INDEX&#39;</span>)</div>
<div class="line">                             || undef,</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line">    my $sp_index = $self-&gt;get_param (<span class="stringliteral">&#39;SPATIAL_INDEX&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #  use existing offsets if they exist</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #  (eg if this is a randomisation based on some original sp_calc)</span></div>
<div class="line"><span class="preprocessor"></span>    my $search_blocks_ref = $self-&gt;get_param (<span class="stringliteral">&#39;INDEX_SEARCH_BLOCKS&#39;</span>)</div>
<div class="line">                            || [];</div>
<div class="line">    $spatial_params_ref   = $self-&gt;get_param (<span class="stringliteral">&#39;SPATIAL_PARAMS&#39;</span>)</div>
<div class="line">                            || [];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (! $use_nbrs_from) {</div>
<div class="line"><span class="preprocessor">        #  first look for a sibling with the same spatial parameters</span></div>
<div class="line"><span class="preprocessor"></span>        $use_nbrs_from = eval {</div>
<div class="line">            $bd-&gt;get_outputs_with_same_conditions (compare_with =&gt; $self);</div>
<div class="line">        };</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">    #  try again if we didn&#39;t get it before, </span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #  but this time check the index</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span> (! $use_nbrs_from) {</div>
<div class="line"></div>
<div class="line">        SPATIAL_PARAMS_LOOP:</div>
<div class="line">        <span class="keywordflow">for</span> my $i (0 .. $#$spatial_params_ref) {</div>
<div class="line">            my $set_i = $i + 1;</div>
<div class="line">            my $result_type = $spatial_params_ref-&gt;[$i]-&gt;get_result_type;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ($result_type eq <span class="stringliteral">&#39;always_true&#39;</span>) {</div>
<div class="line"><span class="preprocessor">                #  no point using the index if we have to get them all</span></div>
<div class="line"><span class="preprocessor"></span>                say <span class="stringliteral">&quot;[SPATIAL] All groups are neighbours.  Index will be ignored for neighbour set $set_i.&quot;</span>;</div>
<div class="line">                next SPATIAL_PARAMS_LOOP;</div>
<div class="line">            }</div>
<div class="line">            elsif ($result_type eq <span class="stringliteral">&#39;self_only&#39;</span>) {</div>
<div class="line">                say <span class="stringliteral">&quot;[SPATIAL] No neighbours, processing group only.  Index will be ignored for neighbour set $set_i.&quot;</span>;</div>
<div class="line">                next SPATIAL_PARAMS_LOOP;</div>
<div class="line">            }</div>
<div class="line">            elsif ($spatial_params_ref-&gt;[$i]-&gt;get_param (<span class="stringliteral">&#39;INDEX_NO_USE&#39;</span>)) { #  or <span class="keywordflow">if</span> the conditions won<span class="stringliteral">&#39;t cooperate with the index</span></div>
<div class="line"><span class="stringliteral">                say &quot;[SPATIAL] Index set to be ignored for neighbour set $set_i.&quot;;  #  put this feedback in the spatialparams?</span></div>
<div class="line"><span class="stringliteral">                next SPATIAL_PARAMS_LOOP;</span></div>
<div class="line"><span class="stringliteral">            }</span></div>
<div class="line"><span class="stringliteral">            else {</span></div>
<div class="line"><span class="stringliteral">                say &quot;[SPATIAL] Result type for neighbour set $set_i is $result_type.&quot;</span></div>
<div class="line"><span class="stringliteral">            }</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">            my $searchBlocks = $search_blocks_ref-&gt;[$i];</span></div>
<div class="line"><span class="stringliteral">            </span></div>
<div class="line"><span class="stringliteral">            if (defined $sp_index &amp;&amp; ! defined $searchBlocks) {</span></div>
<div class="line"><span class="stringliteral">                print &quot;[SPATIAL] Using spatial index\n&quot; if $i == 0;</span></div>
<div class="line"><span class="stringliteral">                my $progress_text_pfx = &#39;</span>Neighbour <span class="keyword">set</span> <span class="stringliteral">&#39; . ($i+1);</span></div>
<div class="line"><span class="stringliteral">                $searchBlocks = $sp_index-&gt;predict_offsets (</span></div>
<div class="line"><span class="stringliteral">                    spatial_params    =&gt; $spatial_params_ref-&gt;[$i],</span></div>
<div class="line"><span class="stringliteral">                    cellsizes         =&gt; $bd-&gt;get_param (&#39;</span>CELL_SIZES<span class="stringliteral">&#39;),</span></div>
<div class="line"><span class="stringliteral">                    progress_text_pfx =&gt; $progress_text_pfx,</span></div>
<div class="line"><span class="stringliteral">                );</span></div>
<div class="line"><span class="stringliteral">                $search_blocks_ref-&gt;[$i] = $searchBlocks;</span></div>
<div class="line"><span class="stringliteral">            }</span></div>
<div class="line"><span class="stringliteral">        }</span></div>
<div class="line"><span class="stringliteral">    }</span></div>
</div><!-- fragment --> 
</div>
 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>lib/Biodiverse/<a class="el" href="Spatial_8pm_source.html">Spatial.pm</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>Biodiverse</b></li><li class="navelem"><a class="el" href="classBiodiverse_1_1Spatial.html">Spatial</a></li>
    <li class="footer">Generated on Tue Nov 5 2013 19:07:27 for Biodiverse by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
